<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Make a boquet</title>
    <link rel="stylesheet" href="make-boquet.css">
</head>

<body>
    <header>
        <h1>Customise | &#x2728;</h1>

    </header>
    <div class="wrapper">
        <div class="left-section">
            <img src="make-boquet.jpg">
            <h3 data-price></h3>
        </div>
        <div class="choose-section">
            <section>
                <p>No. of flowers including accesories: </p>
                <input type="text" placeholder="No. of flowers" data-flowers><br><br>

                <button class="submit" id="submit">Submit</button>
                <button data-reset>Reset</button>
            </section>
            <section id="flower-dropdowns" data-flower-dropdown-container>
                <section>
                    <p data-flower-count>Flower 1</p>
                    <section data-color-container>
                        <select name="" id="test" class="dropdown" data-select-dropdown>
                            <option value="" data-option></option>
                        </select>
                        <button data-color></button>

                    </section>

                </section>
                <section>
                    <p data-flower-count>Flower 1</p>
                    <section data-color-container>
                        <select name="" id="test" class="dropdown" data-select-dropdown>
                            <option value="" data-option></option>
                        </select>
                        <button data-color></button>

                    </section>

                </section>
                <section>
                    <p data-flower-count>Flower 1</p>
                    <section data-color-container>
                        <select name="" id="test" class="dropdown" data-select-dropdown>
                            <option value="" data-option></option>
                        </select>
                        <button data-color></button>

                    </section>

                </section>
                <section>
                    <p data-flower-count>Flower 1</p>
                    <section data-color-container>
                        <select name="" id="test" class="dropdown" data-select-dropdown>
                            <option value="" data-option></option>
                        </select>
                        <button data-color></button>

                    </section>

                </section>
                <section>
                    <p data-flower-count>Flower 1</p>
                    <section data-color-container>
                        <select name="" id="test" class="dropdown" data-select-dropdown>
                            <option value="" data-option></option>
                        </select>
                        <button data-color></button>

                    </section>

                </section>
                <section>
                    <p data-flower-count>Flower 1</p>
                    <section data-color-container>
                        <select name="" id="test" class="dropdown" data-select-dropdown>
                            <option value="" data-option></option>
                        </select>
                        <button data-color></button>

                    </section>

                </section>
                <section>
                    <p data-flower-count>Flower 1</p>
                    <section data-color-container>
                        <select name="" id="test" class="dropdown" data-select-dropdown>
                            <option value="" data-option></option>
                        </select>
                        <button data-color></button>

                    </section>
                    <button data-submit-flower>Submit</button>
                </section>


            </section>
            <section id="total-section">
                <h4 id="total-heading">Total</h4>
                <p>Tulip 2x</p>

            </section>
        </div>
    </div>
    <template data-dropdowns>
        <section>
            <p data-flower-count>Flower 1</p>
            <section data-color-container>
                <select name="" id="test" class="dropdown" data-select-dropdown>
                    <option value="" data-option></option>
                </select>
                <button data-color></button>

            </section>

        </section>

    </template>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js'
        import { getDatabase, ref, child, get } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";
        const firebaseConfig = {
            apiKey: "AIzaSyCkDL6o5zIadycIqJoROr48mqUB3EkZab0",
            authDomain: "mikutoys-d47de.firebaseapp.com",
            databaseURL: "https://mikutoys-d47de-default-rtdb.firebaseio.com",
            projectId: "mikutoys-d47de",
            storageBucket: "mikutoys-d47de.appspot.com",
            messagingSenderId: "453934610008",
            appId: "1:453934610008:web:092e9ad475e2c675773c2d"
        };
        var data = {}
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const dbRef = ref(getDatabase());
        const submitButton = document.getElementById('submit');
        const noOfFlowersInput = document.querySelector('[data-flowers]')
        const dropdownTemplate = document.querySelector('[data-dropdowns]')
        const dropdownContainer = document.querySelector('[data-flower-dropdown-container]')
        const resetButton = document.querySelector('[data-reset]')

        var flowerNumber = 0
        var counter = 0
        var flowerData;
        var flowerKeys;
        var noOfFlowers;
        await get(child(dbRef, '/Flowers')).then((snapshot) => {
            flowerData = snapshot.val()
            flowerKeys = Object.keys(flowerData)
            noOfFlowers = flowerKeys.length

            submitButton.addEventListener('click', () => {
                counter = noOfFlowersInput.value

                for (let i = 0; i < counter; i++) {
                    flowerNumber = i
                    flowerNumber++
                    const dropdowns = dropdownTemplate.content.cloneNode(true).children[0]
                    const dropdownFlowerNumber = dropdowns.querySelector('[data-flower-count]')
                    dropdownFlowerNumber.textContent = `Flower ${flowerNumber}`


                    flowerKeys.forEach(function (flower) {
                        const options = dropdowns.querySelector('[data-option]')
                        const optionsContainer = dropdowns.querySelector('[data-select-dropdown]')
                        const optionsSelect = options.cloneNode()
                        optionsSelect.setAttribute('value', flower)
                        optionsSelect.textContent = `${flowerData[flower].name}  -Rs${flowerData[flower].price}`
                        optionsContainer.append(optionsSelect)
                    })
                    dropdownContainer.append(dropdowns)

                }

            })
            resetButton.addEventListener('click', () => {
                counter = 0
                dropdownContainer.innerHTML = ""
            })


        })




    </script>
</body>

</html>